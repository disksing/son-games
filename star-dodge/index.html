<!doctype html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <title>æ˜Ÿé™…èº²é¿</title>
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            background: #000;
            color: #f0f6ff;
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            overflow: hidden;
        }

        #game {
            display: block;
            width: 100vw;
            height: 100vh;
            margin: 0;
            background: #020615;
            touch-action: none;
        }

        .hud {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 16px;
            padding: 12px;
            z-index: 10;
            pointer-events: none;
        }

        .pill {
            pointer-events: auto;
            background: rgba(10, 20, 40, .8);
            border: 1px solid rgba(120, 180, 255, .3);
            border-radius: 999px;
            padding: 6px 14px;
            font-size: 14px;
        }

        .btn {
            cursor: pointer;
            user-select: none;
        }

        .btn:hover {
            background: rgba(120, 180, 255, .15);
        }

        .center {
            position: fixed;
            inset: 0;
            display: grid;
            place-items: center;
            z-index: 20;
        }

        .panel {
            background: rgba(5, 10, 25, .92);
            border: 1px solid rgba(120, 180, 255, .3);
            border-radius: 18px;
            padding: 28px 32px;
            max-width: 420px;
            text-align: center;
            box-shadow: 0 12px 36px rgba(0, 0, 0, .55);
        }

        .title {
            font-size: 26px;
            font-weight: 700;
            color: #8cd9ff;
            margin-bottom: 12px;
        }

        .sub {
            font-size: 14px;
            line-height: 1.7;
            opacity: 0.9;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 18px;
            flex-wrap: wrap;
        }
    </style>
</head>

<body>
    <canvas id="game"></canvas>
    <div class="hud">
        <div class="pill">ğŸš€ é£èˆ¹ç”Ÿå‘½: <span id="hp">100</span>/100</div>
        <div class="pill">ğŸŒŒ å½“å‰å…³å¡: <span id="level">1</span>/100</div>
        <div class="pill btn" id="pauseBtn">æš‚åœ â¸</div>
    </div>
    <div id="overlay" class="center"></div>

    <script>
        (function () {
            const canvas = document.getElementById('game');
            const ctx = canvas.getContext('2d');
            let baseW = window.innerWidth || 800;
            let baseH = window.innerHeight || 600;

            const overlay = document.getElementById('overlay');
            const hpEl = document.getElementById('hp');
            const levelEl = document.getElementById('level');
            const pauseBtn = document.getElementById('pauseBtn');

            const state = {
                playing: false,
                paused: false,
                hp: 100,
                maxHp: 100,
                level: 1,
                maxLevel: 100,
                elapsedInLevel: 0,
                levelDuration: 60,
                asteroids: [],
                stars: [],
                tick: 0,
                gameTime: 0,
                spawnAccumulator: 0,
                player: {
                    x: baseW * 0.5,
                    y: baseH * 0.8,
                    vx: 0,
                    vy: 0,
                    w: 46,
                    h: 64,
                    maxVx: 6,
                    maxVy: 6
                }
            };

            const keys = { left: false, right: false, up: false, down: false };

            const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

            function initStars() {
                const baseDensity = 120;
                const scale = Math.max(1, (baseW * baseH) / (800 * 600));
                const count = Math.round(baseDensity * scale);
                state.stars.length = 0;
                for (let i = 0; i < count; i++) {
                    state.stars.push({
                        x: Math.random() * baseW,
                        y: Math.random() * baseH,
                        speed: 0.5 + Math.random() * 1.5,
                        size: Math.random() * 2 + 1,
                        twinkle: Math.random() * Math.PI * 2
                    });
                }
            }

            function resizeCanvas(initial = false) {
                const oldW = baseW;
                const oldH = baseH;

                baseW = window.innerWidth || 800;
                baseH = window.innerHeight || 600;

                canvas.width = baseW;
                canvas.height = baseH;

                const scaleX = oldW ? baseW / oldW : 1;
                const scaleY = oldH ? baseH / oldH : 1;

                if (initial) {
                    state.player.x = baseW * 0.5;
                    state.player.y = baseH * 0.8;
                } else {
                    state.player.x *= scaleX;
                    state.player.y *= scaleY;
                }

                state.player.x = clamp(state.player.x, state.player.w / 2, baseW - state.player.w / 2);
                state.player.y = clamp(state.player.y, state.player.h / 2, baseH - state.player.h / 2);

                for (const a of state.asteroids) {
                    a.x *= scaleX;
                    a.y *= scaleY;
                }

                initStars();
            }

            function showStart() {
                overlay.innerHTML = `
        <div class="panel">
          <div class="title">æ˜Ÿé™…èº²é¿</div>
          <div class="sub">
            ä½¿ç”¨æ–¹å‘é”®æ§åˆ¶é£èˆ¹åœ¨å¤ªç©ºä¸­èº²é¿é™¨çŸ³ã€‚<br>
            ğŸš¨ è¢«é™¨çŸ³æ’å‡»ä¼šæ‰£ 10 ç‚¹ç”Ÿå‘½å€¼ï¼Œåˆå§‹æ€»ç”Ÿå‘½ 100ã€‚<br>
            ğŸŒŸ æ¯å…³åšæŒ 60 ç§’è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€å…³ã€‚<br>
            ğŸŒŒ é™¨çŸ³ä¼šè¶Šæ¥è¶Šå¤šï¼Œä½†èŠ‚å¥ä¼šå¾ªåºæ¸è¿›ã€‚
          </div>
          <div class="controls">
            <div class="pill btn" id="startBtn">å¼€å§‹æ¸¸æˆ â–¶</div>
          </div>
        </div>`;
                const startBtn = document.getElementById('startBtn');
                if (startBtn) {
                    startBtn.onclick = () => {
                        startGame();
                    };
                }
            }

            function showGameOver() {
                overlay.innerHTML = `
        <div class="panel">
          <div class="title">ä»»åŠ¡å¤±è´¥</div>
          <div class="sub">
            ä½ çš„é£èˆ¹åœ¨ç¬¬ ${state.level} å…³è¢«å‡»æ¯ã€‚<br>
            æ€»åšæŒæ—¶é—´ï¼š${Math.floor(state.gameTime)} ç§’ã€‚
          </div>
          <div class="controls">
            <div class="pill btn" id="retryBtn">é‡æ–°å¼€å§‹ â†»</div>
          </div>
        </div>`;
                const retryBtn = document.getElementById('retryBtn');
                if (retryBtn) retryBtn.onclick = startGame;
            }

            function clearOverlay() {
                overlay.innerHTML = '';
            }

            function resetGame() {
                state.playing = true;
                state.paused = false;
                state.hp = state.maxHp;
                state.level = 1;
                state.elapsedInLevel = 0;
                state.gameTime = 0;
                state.spawnAccumulator = 0;
                state.asteroids.length = 0;
                state.tick = 0;
                state.player.x = baseW * 0.5;
                state.player.y = baseH * 0.8;
                state.player.vx = 0;
                state.player.vy = 0;
                initStars();
            }

            function startGame() {
                resetGame();
                clearOverlay();
            }

            function endGame() {
                state.playing = false;
                showGameOver();
            }

            function togglePause() {
                if (!state.playing) return;
                state.paused = !state.paused;
                pauseBtn.textContent = state.paused ? 'ç»§ç»­ â–¶' : 'æš‚åœ â¸';
            }
            pauseBtn.onclick = togglePause;

            window.addEventListener('keydown', (e) => {
                if (overlay.innerHTML.trim() !== '') return;
                if (e.key === 'ArrowLeft') keys.left = true;
                if (e.key === 'ArrowRight') keys.right = true;
                if (e.key === 'ArrowUp') keys.up = true;
                if (e.key === 'ArrowDown') keys.down = true;
                if (e.key.toLowerCase() === 'p') togglePause();
            });
            window.addEventListener('keyup', (e) => {
                if (overlay.innerHTML.trim() !== '') return;
                if (e.key === 'ArrowLeft') keys.left = false;
                if (e.key === 'ArrowRight') keys.right = false;
                if (e.key === 'ArrowUp') keys.up = false;
                if (e.key === 'ArrowDown') keys.down = false;
            });

            function getLevelConfig(level) {
                const ratio = Math.min(1, (level - 1) / 99);
                const baseSpawn = Math.max(20, Math.round(60 - ratio * 35)); // åŸºç¡€ç”Ÿæˆé—´éš”
                const spawnRatePerSec = 3 + ratio * 4; // ç¬¬ä¸€å…³æ¯ç§’3ä¸ªï¼Œç¬¬100å…³æ¯ç§’çº¦7ä¸ª
                const maxCount = Math.min(5 + Math.floor(level * 0.2), 25); // ä¿è¯å±å¹•æœ€å¤š25ä¸ªå·¦å³
                return {
                    spawnRate: spawnRatePerSec,
                    speedMin: (1.5 + ratio * 2.5) * 1.3,
                    speedMax: (2.5 + ratio * 3.5) * 1.3,
                    sizeMin: 18 * 1.15,
                    sizeMax: 34 * 1.15,
                    maxAsteroids: maxCount
                };
            }

            function spawnAsteroid() {
                const cfg = getLevelConfig(state.level);
                if (state.asteroids.length >= cfg.maxAsteroids) return;

                const size = cfg.sizeMin + Math.random() * (cfg.sizeMax - cfg.sizeMin);

                const playerZoneWidth = baseW * 0.4;
                const avoidLeft = Math.max(0, state.player.x - playerZoneWidth / 2);
                const avoidRight = Math.min(baseW, state.player.x + playerZoneWidth / 2);

                let x = Math.random() * baseW;
                const maxAttempts = 30;
                let attempt = 0;
                const minSeparation = size * 1.5;

                while (attempt < maxAttempts) {
                    const insideSafeZone = x > avoidLeft && x < avoidRight;
                    let tooClose = false;
                    for (const other of state.asteroids) {
                        const limit = (other.size + size) * 0.6;
                        if (Math.abs(other.x - x) < limit) {
                            tooClose = true;
                            break;
                        }
                    }
                    if (!insideSafeZone && !tooClose) break;
                    x = Math.random() * baseW;
                    attempt++;
                }

                if (attempt >= maxAttempts) {
                    const side = Math.random() < 0.5 ? avoidLeft : avoidRight;
                    const offset = size + Math.random() * Math.max(baseW * 0.3, minSeparation);
                    x = side < state.player.x ? side - offset : side + offset;
                }

                x = clamp(x, size, baseW - size);
                const facets = 6 + Math.floor(Math.random() * 4);
                const points = [];
                for (let i = 0; i < facets; i++) {
                    const angle = (i / facets) * Math.PI * 2;
                    const radius = size * (0.7 + Math.random() * 0.3);
                    points.push({
                        x: Math.cos(angle) * radius,
                        y: Math.sin(angle) * radius
                    });
                }

                state.asteroids.push({
                    x,
                    y: -size,
                    vx: (Math.random() - 0.5) * 1.2,
                    vy: cfg.speedMin + Math.random() * (cfg.speedMax - cfg.speedMin),
                    size,
                    rotation: Math.random() * Math.PI * 2,
                    rotationSpeed: 0,
                    points
                });
            }

            function drawBackground() {
                const grad = ctx.createRadialGradient(baseW / 2, baseH / 2, 0, baseW / 2, baseH / 2, baseW);
                grad.addColorStop(0, '#050c1f');
                grad.addColorStop(0.5, '#0c1a3c');
                grad.addColorStop(1, '#01030a');
                ctx.fillStyle = grad;
                ctx.fillRect(0, 0, baseW, baseH);

                state.stars.forEach(star => {
                    star.y += star.speed;
                    if (star.y > baseH) star.y = -5;
                    star.twinkle += 0.02;
                    const twinkle = (Math.sin(star.twinkle) + 1) / 2 * 0.5 + 0.5;
                    ctx.fillStyle = `rgba(180, 220, 255, ${twinkle})`;
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                    ctx.fill();
                });
            }

            function drawShip() {
                const p = state.player;
                ctx.save();
                ctx.translate(p.x, p.y);

                const bodyGrad = ctx.createLinearGradient(0, -p.h / 2, 0, p.h / 2);
                bodyGrad.addColorStop(0, '#8cd9ff');
                bodyGrad.addColorStop(1, '#436dff');

                ctx.fillStyle = bodyGrad;
                ctx.beginPath();
                ctx.moveTo(0, -p.h / 2);
                ctx.quadraticCurveTo(p.w / 2, 0, 0, p.h / 2);
                ctx.quadraticCurveTo(-p.w / 2, 0, 0, -p.h / 2);
                ctx.fill();

                ctx.fillStyle = '#0d1b4b';
                ctx.beginPath();
                ctx.ellipse(0, -p.h / 4, p.w / 3, p.h / 6, 0, 0, Math.PI * 2);
                ctx.fill();

                ctx.strokeStyle = 'rgba(140, 217, 255, 0.7)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(-p.w / 2 + 6, p.h / 4);
                ctx.lineTo(0, p.h / 2);
                ctx.lineTo(p.w / 2 - 6, p.h / 4);
                ctx.stroke();

                ctx.restore();
            }

            function drawAsteroid(a) {
                ctx.save();
                ctx.translate(a.x, a.y);
                ctx.rotate(a.rotation);

                const grad = ctx.createRadialGradient(0, 0, a.size * 0.2, 0, 0, a.size);
                grad.addColorStop(0, '#f5f5f5');
                grad.addColorStop(0.4, '#c9c9c9');
                grad.addColorStop(1, '#7b7b7b');
                ctx.fillStyle = grad;

                ctx.beginPath();
                const points = a.points && a.points.length ? a.points : null;
                if (points) {
                    ctx.moveTo(points[0].x, points[0].y);
                    for (let i = 1; i < points.length; i++) {
                        ctx.lineTo(points[i].x, points[i].y);
                    }
                    ctx.closePath();
                    ctx.fill();
                } else {
                    ctx.arc(0, 0, a.size, 0, Math.PI * 2);
                    ctx.fill();
                }

                ctx.fillStyle = 'rgba(255,255,255,0.3)';
                ctx.beginPath();
                ctx.ellipse(-a.size * 0.2, -a.size * 0.2, a.size * 0.4, a.size * 0.25, 0.6, 0, Math.PI * 2);
                ctx.fill();

                ctx.restore();
            }

            function updateAsteroids(dt) {
                for (let i = state.asteroids.length - 1; i >= 0; i--) {
                    const a = state.asteroids[i];
                    a.x += a.vx * dt;
                    a.y += a.vy * dt;
                    a.rotation += a.rotationSpeed * dt;
                    drawAsteroid(a);

                    if (a.y > baseH + a.size * 2 || a.x < -a.size * 2 || a.x > baseW + a.size * 2) {
                        state.asteroids.splice(i, 1);
                    }
                }
            }

            function checkCollisions() {
                const p = state.player;
                for (let i = 0; i < state.asteroids.length; i++) {
                    const a = state.asteroids[i];
                    const dx = p.x - a.x;
                    const dy = p.y - a.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < a.size * 0.8 + Math.max(p.w, p.h) / 3) {
                        state.hp -= 10;
                        state.asteroids.splice(i, 1);
                        return;
                    }
                }
            }

            let lastTime = performance.now();
            function loop(now) {
                requestAnimationFrame(loop);
                const dt = Math.min(33, now - lastTime) / 16.6667;
                lastTime = now;

                hpEl.textContent = Math.max(0, state.hp);
                levelEl.textContent = state.level;

                if (!state.playing) {
                    drawBackground();
                    if (overlay.innerHTML.trim() === '') showStart();
                    return;
                }

                if (state.paused) {
                    drawBackground();
                    drawShip();
                    state.asteroids.forEach(drawAsteroid);
                    return;
                }

                state.tick++;
                state.gameTime += dt / 60;
                state.elapsedInLevel += dt / 60;

                drawBackground();

                const acceleration = 0.6;
                const friction = 0.9;

                if (keys.left) state.player.vx -= acceleration;
                if (keys.right) state.player.vx += acceleration;
                if (keys.up) state.player.vy -= acceleration;
                if (keys.down) state.player.vy += acceleration;

                state.player.vx = clamp(state.player.vx, -state.player.maxVx, state.player.maxVx);
                state.player.vy = clamp(state.player.vy, -state.player.maxVy, state.player.maxVy);

                state.player.x += state.player.vx * dt;
                state.player.y += state.player.vy * dt;

                state.player.vx *= friction;
                state.player.vy *= friction;

                state.player.x = clamp(state.player.x, state.player.w / 2, baseW - state.player.w / 2);
                state.player.y = clamp(state.player.y, state.player.h / 2, baseH - state.player.h / 2);

                drawShip();

                const cfg = getLevelConfig(state.level);
                state.spawnAccumulator += cfg.spawnRate * (dt / 60);
                while (state.spawnAccumulator >= 1) {
                    spawnAsteroid();
                    state.spawnAccumulator -= 1;
                }

                updateAsteroids(dt);
                checkCollisions();

                if (state.hp <= 0) {
                    endGame();
                    return;
                }

                if (state.elapsedInLevel >= state.levelDuration) {
                    if (state.level < state.maxLevel) {
                        state.level++;
                        state.elapsedInLevel = 0;
                        state.asteroids.length = 0;
                    } else {
                        state.playing = false;
                        overlay.innerHTML = `
          <div class="panel">
            <div class="title">æ­å–œé€šå…³ï¼</div>
            <div class="sub">ä½ æˆåŠŸèº²è¿‡äº†å…¨éƒ¨ 100 å…³é™¨çŸ³ã€‚</div>
            <div class="controls">
              <div class="pill btn" id="restartBtn">é‡æ–°å¼€å§‹ â†»</div>
            </div>
          </div>`;
                        const restartBtn = document.getElementById('restartBtn');
                        if (restartBtn) restartBtn.onclick = startGame;
                    }
                }
            }

            resizeCanvas(true);
            window.addEventListener('resize', () => resizeCanvas(false));
            requestAnimationFrame(loop);
            showStart();
        })();
    </script>
</body>

</html>