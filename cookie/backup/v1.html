<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cookie Clicker Mini</title>
    <style>
        :root {
            --cookie-size: 320px;
            --cookie-base: #d9a066;
            --cookie-deep: #c0833a;
            --chip: #4b2e17;
            --text: #2d1f0f;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100dvh;
            display: grid;
            place-items: center;
            background: radial-gradient(1200px 600px at 50% -20%, #fff8e7 0%, #f3ead6 45%, #e9e0cc 100%);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Arial, sans-serif;
        }

        .stage {
            display: grid;
            grid-template-columns: 1fr 280px;
            align-items: start;
            gap: 18px;
        }

        .cookie {
            position: relative;
            width: var(--cookie-size);
            height: var(--cookie-size);
            border-radius: 50%;
            cursor: pointer;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            background:
                radial-gradient(circle at 30% 30%, #eaba76 0%, var(--cookie-base) 42%, var(--cookie-deep) 100%);
            box-shadow:
                inset 0 12px 24px rgba(0, 0, 0, .18),
                0 22px 50px rgba(0, 0, 0, .25);
            transition: transform 60ms ease-out, filter 60ms ease-out;
            outline: none;
        }

        .cookie:active,
        .cookie.pop {
            transform: scale(0.96);
            filter: brightness(0.98);
        }

        .cookie::before {
            /* glossy + shade */
            content: "";
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background:
                radial-gradient(40% 35% at 30% 28%, rgba(255, 255, 255, .38), transparent 60%),
                radial-gradient(60% 50% at 65% 70%, rgba(0, 0, 0, .10), transparent 60%);
            pointer-events: none;
        }

        /* chocolate chips */
        .chip {
            position: absolute;
            width: 16px;
            height: 16px;
            background: var(--chip);
            border-radius: 50%;
            box-shadow: inset 0 2px 2px rgba(255, 255, 255, .15), 0 2px 2px rgba(0, 0, 0, .25);
            opacity: .95;
        }

        .counter {
            position: absolute;
            inset: 0;
            display: grid;
            place-items: center;
            font-weight: 900;
            color: var(--text);
            text-shadow: 0 2px 0 rgba(255, 255, 255, .35), 0 4px 14px rgba(0, 0, 0, .25);
            font-size: clamp(40px, 10vw, 86px);
            pointer-events: none;
        }

        .hint {
            color: rgba(0, 0, 0, .65);
            font-size: 14px;
            user-select: none;
        }

        /* play area to center cookie and hint */
        .play-area {
            display: grid;
            place-items: center;
            gap: 12px;
        }

        /* shop sidebar */
        .shop {
            width: 280px;
            max-height: min(70vh, 520px);
            overflow: auto;
            padding: 12px;
            border-radius: 14px;
            background: rgba(255, 255, 255, .75);
            box-shadow: 0 14px 40px rgba(0, 0, 0, .15), inset 0 2px 0 rgba(255, 255, 255, .6);
            backdrop-filter: blur(6px);
        }

        .shop-title {
            margin: 0 0 8px 0;
            font-size: 16px;
            color: #333;
            font-weight: 700;
        }

        .item {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 8px 12px;
            align-items: center;
            padding: 10px 10px;
            border-radius: 10px;
            background: #f6f7fb;
            box-shadow: inset 0 -1px 0 rgba(0, 0, 0, .06);
            margin-bottom: 10px;
        }

        .item .name {
            font-weight: 700;
            color: #222;
        }

        .item .desc {
            grid-column: 1 / span 2;
            font-size: 12px;
            color: #586174;
        }

        .item .stat {
            font-size: 12px;
            color: #444;
        }

        .buy-btn {
            appearance: none;
            border: 0;
            border-radius: 8px;
            padding: 6px 10px;
            background: #2f6fed;
            color: #fff;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 6px 14px rgba(47, 111, 237, .35);
        }

        .buy-btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* intentionally no controls: manual clicking only */

        @media (max-width: 760px) {
            .stage {
                grid-template-columns: 1fr;
            }

            .shop {
                width: min(92vw, 420px);
                max-height: none;
            }
        }

        @media (max-width: 420px) {
            :root {
                --cookie-size: 260px;
            }
        }
    </style>
</head>

<body>
    <div class="stage">
        <div class="play-area">
            <div id="cookie" class="cookie" role="button" aria-label="Cookie" tabindex="0">
                <div id="counter" class="counter">0</div>


                <!-- decorative chips -->
                <span class="chip" style="left: 22%; top: 24%; transform: rotate(10deg);"></span>
                <span class="chip" style="left: 66%; top: 32%; transform: scale(1.2);"></span>
                <span class="chip" style="left: 40%; top: 60%;"></span>
                <span class="chip" style="left: 70%; top: 68%; transform: rotate(-15deg);"></span>
                <span class="chip" style="left: 28%; top: 72%; transform: scale(0.9);"></span>
            </div>
            <div class="hint" aria-hidden="true">点击饼干增加数量</div>
        </div>
        <aside id="shop" class="shop" aria-label="道具栏">
            <h3 class="shop-title">道具栏</h3>
            <div id="shopItems"></div>
        </aside>
    </div>

    <script>
        // Minimal cookie clicker
        (() => {
            const cookie = document.getElementById('cookie');
            const counter = document.getElementById('counter');
            const shopRoot = document.getElementById('shop');
            const shopItemsRoot = document.getElementById('shopItems');

            let count = 0;

            // Shop data
            const items = [
                {
                    id: 'turtle',
                    name: '乌龟',
                    basePrice: 10,
                    priceMultiplier: 1.75,
                    cps: 0.1,
                    count: 0
                },
                {
                    id: 'snail',
                    name: '蜗牛',
                    basePrice: 40,
                    priceMultiplier: 1.25,
                    cps: 0.2,
                    count: 0
                },
                {
                    id: 'plane',
                    name: '飞机',
                    basePrice: 100,
                    priceMultiplier: 1.75,
                    cps: 1,
                    count: 0
                },
                {
                    id: 'factory',
                    name: '工厂',
                    basePrice: 300,
                    priceMultiplier: 1.15,
                    cps: 10,
                    count: 0
                },
                {
                    id: 'rocket',
                    name: '火箭',
                    basePrice: 2000,
                    priceMultiplier: 1.2,
                    cps: 50,
                    count: 0
                }
            ];

            function getItemPrice(item) {
                const price = item.basePrice * Math.pow(item.priceMultiplier, item.count);
                return Math.max(1, Math.floor(price));
            }

            // Sound: lightweight click using Web Audio API
            let audioCtx = null;
            function getAudioContext() {
                if (!audioCtx) {
                    const Ctx = window.AudioContext || window.webkitAudioContext;
                    if (!Ctx) return null;
                    audioCtx = new Ctx();
                }
                if (audioCtx.state === 'suspended') {
                    // Ensure playback after user gesture in some browsers
                    audioCtx.resume();
                }
                return audioCtx;
            }

            function playClick() {
                const ctx = getAudioContext();
                if (!ctx) return;
                const t = ctx.currentTime;
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();

                // Short percussive blip
                osc.type = 'square';
                osc.frequency.setValueAtTime(900, t);

                gain.gain.setValueAtTime(0.0001, t);
                gain.gain.exponentialRampToValueAtTime(0.35, t + 0.008);
                gain.gain.exponentialRampToValueAtTime(0.0001, t + 0.09);

                osc.connect(gain).connect(ctx.destination);
                osc.start(t);
                osc.stop(t + 0.1);
                osc.onended = () => {
                    try { osc.disconnect(); gain.disconnect(); } catch { }
                };
            }

            function formatCount(value) {
                if (value < 1000) return String(value);
                const units = ['K', 'M', 'G', 'T', 'P', 'E', 'Z', 'Y'];
                let unitIndex = -1;
                let num = value;
                while (num >= 1000 && unitIndex < units.length - 1) {
                    num /= 1000;
                    unitIndex++;
                }
                const formatted = num >= 100
                    ? num.toFixed(0)
                    : num >= 10
                        ? num.toFixed(1)
                        : num.toFixed(2);
                return formatted + units[unitIndex];
            }

            function render() {
                counter.textContent = formatCount(count);
            }

            function renderShop() {
                if (!shopItemsRoot) return;
                const fragments = document.createDocumentFragment();
                items.forEach((item) => {
                    const el = document.createElement('div');
                    el.className = 'item';
                    const price = getItemPrice(item);
                    const affordable = count >= price;
                    const totalCps = item.count * item.cps;
                    el.innerHTML = `
                        <div class="name">${item.name}</div>
                        <button class="buy-btn" data-action="buy" data-id="${item.id}" ${affordable ? '' : 'disabled'}>购买</button>
                        <div class="stat">数量：<strong>${item.count}</strong></div>
                        <div class="stat">价格：<strong>${formatCount(price)}</strong></div>
                        <div class="desc">生产速度：每个每秒 +${formatCount(item.cps)}，总共每秒 +${formatCount(totalCps)}</div>
                    `;
                    fragments.appendChild(el);
                });
                shopItemsRoot.replaceChildren(fragments);
            }

            function pop() {
                cookie.classList.add('pop');
                setTimeout(() => cookie.classList.remove('pop'), 80);
            }

            cookie.addEventListener('click', () => {
                count += 1;
                render();
                pop();
                playClick();
                renderShop();
            });

            // Debug: middle mouse adds 10 cookies once
            const supportsAuxClick = 'onauxclick' in window;
            function addTenCookiesDebug() {
                count += 10;
                render();
                pop();
                playClick();
                renderShop();
            }
            if (supportsAuxClick) {
                cookie.addEventListener('auxclick', (e) => {
                    if (e.button === 1) {
                        e.preventDefault();
                        addTenCookiesDebug();
                    }
                });
            } else {
                cookie.addEventListener('mousedown', (e) => {
                    if (e.button === 1) {
                        e.preventDefault();
                        addTenCookiesDebug();
                    }
                });
            }

            // Shop interactions
            if (shopRoot) {
                shopRoot.addEventListener('click', (e) => {
                    const target = e.target;
                    if (!target || !(target instanceof Element)) return;
                    const btn = target.closest('button[data-action="buy"]');
                    if (!btn) return;
                    const id = btn.getAttribute('data-id');
                    const item = items.find(x => x.id === id);
                    if (!item) return;
                    const price = getItemPrice(item);
                    if (count < price) return;
                    count -= price;
                    item.count += 1;
                    render();
                    renderShop();
                });
            }

            // Auto production loop
            function getTotalCps() {
                let total = 0;
                for (const item of items) total += item.count * item.cps;
                return total;
            }

            let carry = 0; // fractional cookies carried between frames
            let lastTs = performance.now();
            let lastShopRenderTs = lastTs; // throttle shop render to ~1s
            function autoLoop(ts) {
                const dt = (ts - lastTs) / 1000; // seconds
                lastTs = ts;
                const produced = getTotalCps() * dt + carry;
                const add = Math.floor(produced);
                carry = produced - add;
                if (add > 0) {
                    count += add;
                    render();
                }
                if (ts - lastShopRenderTs >= 1000) {
                    renderShop();
                    lastShopRenderTs = ts;
                }
                requestAnimationFrame(autoLoop);
            }
            requestAnimationFrame(autoLoop);

            // removed auto clicker: manual clicking only

            cookie.addEventListener('keydown', (e) => {
                // Keyboard accessibility: Space / Enter to click
                if (e.key === ' ' || e.key === 'Enter') {
                    e.preventDefault();
                    cookie.click();
                }
            });

            render();
            renderShop();
        })();
    </script>
</body>

</html>