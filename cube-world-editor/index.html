<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–¹å—ä¸–ç•Œç¼–è¾‘å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            color: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 5px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .main-container {
            display: flex;
            flex: 1;
            gap: 15px;
            padding: 15px;
            height: calc(100vh - 100px);
        }

        .toolbar {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            width: 300px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }

        .canvas-container {
            flex: 1;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        #gameCanvas {
            border: 3px solid #ff6b6b;
            border-radius: 15px;
            background: linear-gradient(135deg, #87CEEB 0%, #98FB98 100%);
            display: block;
            cursor: crosshair;
            flex: 1;
        }

        .tool-section {
            margin-bottom: 25px;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            border-left: 5px solid #ff6b6b;
        }

        .tool-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tool-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .tool-item {
            aspect-ratio: 1;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .tool-item:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .tool-item.active {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.6);
        }

        .platform {
            background: linear-gradient(135deg, #8B4513, #A0522D);
            color: white;
        }

        .obstacle {
            background: linear-gradient(135deg, #696969, #808080);
            color: white;
        }

        .trampoline {
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            color: white;
        }

        .conveyor {
            background: linear-gradient(135deg, #ffa500, #ff8c00);
            color: white;
        }

        .spike {
            background: linear-gradient(135deg, #ff0000, #dc143c);
            color: white;
        }

        .checkpoint {
            background: linear-gradient(135deg, #00ff00, #32cd32);
            color: white;
        }

        .finish {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
        }

        .decorative {
            background: linear-gradient(135deg, #9370db, #ba55d3);
            color: white;
        }

        .powerup {
            background: linear-gradient(135deg, #00bfff, #1e90ff);
            color: white;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .play-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .clear-btn {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }

        .save-btn {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
        }

        .load-btn {
            background: linear-gradient(135deg, #FF9800, #F57C00);
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .status-bar {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            text-align: center;
            font-size: 16px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .info-panel {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
            font-size: 14px;
            color: #666;
        }

        .file-input {
            display: none;
        }

        .instructions {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.6;
            border-left: 5px solid #ffc107;
        }

        .instructions h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .instructions ul {
            margin-left: 20px;
        }

        .instructions li {
            margin-bottom: 5px;
            color: #856404;
        }

        .emoji {
            font-size: 20px;
        }

        .game-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
        }

        .key-hint {
            display: inline-block;
            background: #333;
            padding: 2px 6px;
            border-radius: 4px;
            margin: 0 2px;
            font-family: monospace;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>ğŸ® æ–¹å—ä¸–ç•Œç¼–è¾‘å™¨</h1>
        <p>åˆ›é€ å±äºä½ çš„æ–¹å—ä¸–ç•Œï¼</p>
    </div>

    <div class="main-container">
        <div class="toolbar">
            <div class="instructions">
                <h4>ğŸ® æ“ä½œè¯´æ˜</h4>
                <ul>
                    <li>é€‰æ‹©å·¥å…·åç‚¹å‡»ç”»å¸ƒæ”¾ç½®</li>
                    <li>å³é”®åˆ é™¤å…ƒç´ </li>
                    <li>å¯ä»¥ä¿å­˜å’ŒåŠ è½½åœ°å›¾</li>
                    <li>ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"æµ‹è¯•åœ°å›¾</li>
                    <li>æ¸¸æˆæ¨¡å¼ï¼šWASDç§»åŠ¨ï¼Œç©ºæ ¼è·³è·ƒ</li>
                </ul>
            </div>

            <div class="tool-section">
                <h3>ğŸ§± å¹³å°</h3>
                <div class="tool-grid">
                    <button class="tool-item platform" data-type="platform">
                        <div class="emoji">ğŸŸ«</div>
                        <div>åŸºç¡€å¹³å°</div>
                    </button>
                    <button class="tool-item platform" data-type="moving">
                        <div class="emoji">ğŸŸ¤</div>
                        <div>ç§»åŠ¨å¹³å°</div>
                    </button>
                    <button class="tool-item platform" data-type="disappearing">
                        <div class="emoji">ğŸŸ </div>
                        <div>æ¶ˆå¤±å¹³å°</div>
                    </button>
                    <button class="tool-item platform" data-type="bouncy">
                        <div class="emoji">ğŸŸ£</div>
                        <div>å¼¹è·³å¹³å°</div>
                    </button>
                </div>
            </div>

            <div class="tool-section">
                <h3>ğŸš§ éšœç¢ç‰©</h3>
                <div class="tool-grid">
                    <button class="tool-item obstacle" data-type="wall">
                        <div class="emoji">ğŸ§±</div>
                        <div>å¢™å£</div>
                    </button>
                    <button class="tool-item spike" data-type="spike">
                        <div class="emoji">âš¡</div>
                        <div>å°–åˆº</div>
                    </button>
                    <button class="tool-item obstacle" data-type="rock">
                        <div class="emoji">ğŸª¨</div>
                        <div>å²©çŸ³</div>
                    </button>
                    <button class="tool-item obstacle" data-type="lava">
                        <div class="emoji">ğŸŒ‹</div>
                        <div>å²©æµ†</div>
                    </button>
                </div>
            </div>

            <div class="tool-section">
                <h3>ğŸª æœºå…³</h3>
                <div class="tool-grid">
                    <button class="tool-item trampoline" data-type="trampoline">
                        <div class="emoji">ğŸ¦˜</div>
                        <div>è¹¦åºŠ</div>
                    </button>
                    <button class="tool-item conveyor" data-type="conveyor">
                        <div class="emoji">ğŸ“¦</div>
                        <div>ä¼ é€å¸¦</div>
                    </button>
                    <button class="tool-item obstacle" data-type="door">
                        <div class="emoji">ğŸšª</div>
                        <div>é—¨</div>
                    </button>
                    <button class="tool-item obstacle" data-type="switch">
                        <div class="emoji">ğŸ”˜</div>
                        <div>å¼€å…³</div>
                    </button>
                </div>
            </div>

            <div class="tool-section">
                <h3>ğŸ ç›®æ ‡ç‚¹</h3>
                <div class="tool-grid">
                    <button class="tool-item checkpoint" data-type="checkpoint">
                        <div class="emoji">ğŸƒ</div>
                        <div>æ£€æŸ¥ç‚¹</div>
                    </button>
                    <button class="tool-item finish" data-type="finish">
                        <div class="emoji">ğŸ†</div>
                        <div>ç»ˆç‚¹</div>
                    </button>
                    <button class="tool-item checkpoint" data-type="start">
                        <div class="emoji">ğŸš€</div>
                        <div>èµ·ç‚¹</div>
                    </button>
                    <button class="tool-item checkpoint" data-type="spawn">
                        <div class="emoji">â­</div>
                        <div>é‡ç”Ÿç‚¹</div>
                    </button>
                </div>
            </div>

            <div class="tool-section">
                <h3>ğŸ’ é“å…·</h3>
                <div class="tool-grid">
                    <button class="tool-item powerup" data-type="jump">
                        <div class="emoji">ğŸ¦˜</div>
                        <div>è·³è·ƒå¢å¼º</div>
                    </button>
                    <button class="tool-item powerup" data-type="speed">
                        <div class="emoji">ğŸ’¨</div>
                        <div>é€Ÿåº¦æå‡</div>
                    </button>
                    <button class="tool-item powerup" data-type="shield">
                        <div class="emoji">ğŸ›¡ï¸</div>
                        <div>æŠ¤ç›¾</div>
                    </button>
                    <button class="tool-item powerup" data-type="coin">
                        <div class="emoji">ğŸª™</div>
                        <div>é‡‘å¸</div>
                    </button>
                </div>
            </div>

            <div class="tool-section">
                <h3>ğŸ¨ è£…é¥°</h3>
                <div class="tool-grid">
                    <button class="tool-item decorative" data-type="tree">
                        <div class="emoji">ğŸŒ³</div>
                        <div>æ ‘æœ¨</div>
                    </button>
                    <button class="tool-item decorative" data-type="flower">
                        <div class="emoji">ğŸŒ¸</div>
                        <div>èŠ±æœµ</div>
                    </button>
                    <button class="tool-item decorative" data-type="cloud">
                        <div class="emoji">â˜ï¸</div>
                        <div>äº‘æœµ</div>
                    </button>
                    <button class="tool-item decorative" data-type="star">
                        <div class="emoji">âœ¨</div>
                        <div>æ˜Ÿæ˜Ÿ</div>
                    </button>
                </div>
            </div>

            <div class="controls">
                <button class="control-btn play-btn" id="playBtn">å¼€å§‹æ¸¸æˆ</button>
                <button class="control-btn clear-btn" id="clearBtn">æ¸…ç©ºåœ°å›¾</button>
                <button class="control-btn save-btn" id="saveBtn">ä¿å­˜åœ°å›¾</button>
                <button class="control-btn load-btn" id="loadBtn">åŠ è½½åœ°å›¾</button>
                <input type="file" class="file-input" id="fileInput" accept=".json">
            </div>

            <div class="info-panel">
                <h4>ğŸ“Š åœ°å›¾ä¿¡æ¯</h4>
                <p>å¹³å°æ•°é‡: <span id="platformCount">0</span></p>
                <p>éšœç¢ç‰©æ•°é‡: <span id="obstacleCount">0</span></p>
                <p>é“å…·æ•°é‡: <span id="powerupCount">0</span></p>
                <p>è£…é¥°æ•°é‡: <span id="decorCount">0</span></p>
            </div>
        </div>

        <div class="canvas-container">
            <div class="game-controls">
                <div><span class="key-hint">WASD</span> ç§»åŠ¨</div>
                <div><span class="key-hint">ç©ºæ ¼</span> è·³è·ƒ</div>
                <div><span class="key-hint">ESC</span> é€€å‡ºæ¸¸æˆ</div>
            </div>
            <canvas id="gameCanvas" width="800" height="600"></canvas>
            <div class="status-bar">
                <span id="statusText">é€‰æ‹©å·¥å…·å¼€å§‹åˆ›ä½œ</span>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const statusText = document.getElementById('statusText');
        const platformCount = document.getElementById('platformCount');
        const obstacleCount = document.getElementById('obstacleCount');
        const powerupCount = document.getElementById('powerupCount');
        const decorCount = document.getElementById('decorCount');

        let currentTool = null;
        let gameObjects = [];
        let isPlaying = false;
        let gameLoop;
        let player = null;
        let keys = {};

        class GameObject {
            constructor(x, y, type, width = 40, height = 40) {
                this.x = x;
                this.y = y;
                this.type = type;
                this.width = width;
                this.height = height;
                this.id = Math.random().toString(36).substr(2, 9);
                this.rotation = 0;
                this.velocityX = 0;
                this.velocityY = 0;
                this.isMoving = false;
                this.moveDirection = 1;
                this.moveSpeed = 1;
                this.disappearTimer = 0;
                this.isDisappearing = false;
            }

            draw() {
                ctx.save();
                ctx.translate(this.x + this.width / 2, this.y + this.height / 2);
                ctx.rotate(this.rotation);

                switch (this.type) {
                    case 'platform':
                        this.drawPlatform();
                        break;
                    case 'moving':
                        this.drawMovingPlatform();
                        break;
                    case 'disappearing':
                        this.drawDisappearingPlatform();
                        break;
                    case 'bouncy':
                        this.drawBouncyPlatform();
                        break;
                    case 'wall':
                        this.drawWall();
                        break;
                    case 'spike':
                        this.drawSpike();
                        break;
                    case 'rock':
                        this.drawRock();
                        break;
                    case 'lava':
                        this.drawLava();
                        break;
                    case 'trampoline':
                        this.drawTrampoline();
                        break;
                    case 'conveyor':
                        this.drawConveyor();
                        break;
                    case 'door':
                        this.drawDoor();
                        break;
                    case 'switch':
                        this.drawSwitch();
                        break;
                    case 'checkpoint':
                        this.drawCheckpoint();
                        break;
                    case 'finish':
                        this.drawFinish();
                        break;
                    case 'start':
                        this.drawStart();
                        break;
                    case 'spawn':
                        this.drawSpawn();
                        break;
                    case 'jump':
                        this.drawJump();
                        break;
                    case 'speed':
                        this.drawSpeed();
                        break;
                    case 'shield':
                        this.drawShield();
                        break;
                    case 'coin':
                        this.drawCoin();
                        break;
                    case 'tree':
                        this.drawTree();
                        break;
                    case 'flower':
                        this.drawFlower();
                        break;
                    case 'cloud':
                        this.drawCloud();
                        break;
                    case 'star':
                        this.drawStar();
                        break;
                    case 'player':
                        this.drawPlayer();
                        break;
                }
                ctx.restore();
            }

            drawPlatform() {
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(-20, -20, 40, 40);
                ctx.fillStyle = '#A0522D';
                ctx.fillRect(-18, -18, 36, 36);
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(-15, -15, 30, 30);
            }

            drawMovingPlatform() {
                ctx.fillStyle = '#D2691E';
                ctx.fillRect(-20, -20, 40, 40);
                ctx.fillStyle = '#CD853F';
                ctx.fillRect(-18, -18, 36, 36);
                ctx.fillStyle = '#FFD700';
                ctx.fillRect(-10, -5, 20, 10);
            }

            drawDisappearingPlatform() {
                const alpha = this.isDisappearing ? 0.3 : 1;
                ctx.globalAlpha = alpha;
                ctx.fillStyle = '#FF6347';
                ctx.fillRect(-20, -20, 40, 40);
                ctx.fillStyle = '#FF7F50';
                ctx.fillRect(-18, -18, 36, 36);
                ctx.fillStyle = '#FF4500';
                ctx.fillRect(-15, -15, 30, 30);
                ctx.globalAlpha = 1;
            }

            drawBouncyPlatform() {
                ctx.fillStyle = '#9C27B0';
                ctx.fillRect(-20, -20, 40, 40);
                ctx.fillStyle = '#BA68C8';
                ctx.fillRect(-18, -18, 36, 36);
                ctx.fillStyle = '#E1BEE7';
                ctx.fillRect(-15, -15, 30, 30);
            }

            drawWall() {
                ctx.fillStyle = '#696969';
                ctx.fillRect(-20, -20, 40, 40);
                ctx.fillStyle = '#808080';
                ctx.fillRect(-18, -18, 36, 36);
                ctx.fillStyle = '#A9A9A9';
                ctx.fillRect(-15, -15, 30, 30);
            }

            drawSpike() {
                ctx.fillStyle = '#FF0000';
                ctx.beginPath();
                ctx.moveTo(0, -20);
                ctx.lineTo(-15, 20);
                ctx.lineTo(15, 20);
                ctx.closePath();
                ctx.fill();
                ctx.fillStyle = '#DC143C';
                ctx.beginPath();
                ctx.moveTo(0, -15);
                ctx.lineTo(-10, 15);
                ctx.lineTo(10, 15);
                ctx.closePath();
                ctx.fill();
            }

            drawRock() {
                ctx.fillStyle = '#696969';
                ctx.beginPath();
                ctx.arc(0, 0, 18, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#808080';
                ctx.beginPath();
                ctx.arc(-5, -5, 8, 0, Math.PI * 2);
                ctx.fill();
            }

            drawLava() {
                ctx.fillStyle = '#FF5722';
                ctx.fillRect(-20, -20, 40, 40);
                ctx.fillStyle = '#FF9800';
                ctx.fillRect(-18, -18, 36, 36);
                ctx.fillStyle = '#D84315';
                for (let i = -15; i < 15; i += 3) {
                    for (let j = -15; j < 15; j += 3) {
                        if (Math.random() > 0.6) {
                            ctx.fillRect(i, j, 2, 2);
                        }
                    }
                }
            }

            drawTrampoline() {
                ctx.fillStyle = '#FF69B4';
                ctx.fillRect(-20, -20, 40, 40);
                ctx.fillStyle = '#FF1493';
                ctx.fillRect(-18, -18, 36, 36);
                ctx.fillStyle = '#FFB6C1';
                ctx.fillRect(-15, -15, 30, 30);
                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ğŸ¦˜', 0, 5);
            }

            drawConveyor() {
                ctx.fillStyle = '#FFA500';
                ctx.fillRect(-20, -20, 40, 40);
                ctx.fillStyle = '#FF8C00';
                ctx.fillRect(-18, -18, 36, 36);
                ctx.fillStyle = '#FFD700';
                ctx.fillRect(-15, -10, 30, 20);
                ctx.fillStyle = '#FF6347';
                for (let i = -12; i < 12; i += 6) {
                    ctx.fillRect(i, -5, 3, 10);
                }
            }

            drawDoor() {
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(-20, -20, 40, 40);
                ctx.fillStyle = '#D2691E';
                ctx.fillRect(-18, -18, 36, 36);
                ctx.fillStyle = '#FFD700';
                ctx.fillRect(-15, -15, 30, 30);
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(-5, -15, 10, 30);
            }

            drawSwitch() {
                ctx.fillStyle = '#9C27B0';
                ctx.fillRect(-20, -20, 40, 40);
                ctx.fillStyle = '#BA68C8';
                ctx.fillRect(-18, -18, 36, 36);
                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ğŸ”˜', 0, 5);
            }

            drawCheckpoint() {
                ctx.fillStyle = '#00FF00';
                ctx.fillRect(-20, -20, 40, 40);
                ctx.fillStyle = '#32CD32';
                ctx.fillRect(-18, -18, 36, 36);
                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ğŸƒ', 0, 5);
            }

            drawFinish() {
                ctx.fillStyle = '#FFD700';
                ctx.fillRect(-20, -20, 40, 40);
                ctx.fillStyle = '#FFED4E';
                ctx.fillRect(-18, -18, 36, 36);
                ctx.fillStyle = '#FF6347';
                ctx.font = 'bold 20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ğŸ†', 0, 5);
            }

            drawStart() {
                ctx.fillStyle = '#00BFFF';
                ctx.fillRect(-20, -20, 40, 40);
                ctx.fillStyle = '#1E90FF';
                ctx.fillRect(-18, -18, 36, 36);
                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ğŸš€', 0, 5);
            }

            drawSpawn() {
                ctx.fillStyle = '#4CAF50';
                ctx.fillRect(-20, -20, 40, 40);
                ctx.fillStyle = '#66BB6A';
                ctx.fillRect(-18, -18, 36, 36);
                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('â­', 0, 5);
            }

            drawJump() {
                ctx.fillStyle = '#00BFFF';
                ctx.fillRect(-20, -20, 40, 40);
                ctx.fillStyle = '#1E90FF';
                ctx.fillRect(-18, -18, 36, 36);
                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ğŸ¦˜', 0, 5);
            }

            drawSpeed() {
                ctx.fillStyle = '#FF69B4';
                ctx.fillRect(-20, -20, 40, 40);
                ctx.fillStyle = '#FF1493';
                ctx.fillRect(-18, -18, 36, 36);
                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ğŸ’¨', 0, 5);
            }

            drawShield() {
                ctx.fillStyle = '#9370DB';
                ctx.fillRect(-20, -20, 40, 40);
                ctx.fillStyle = '#BA55D3';
                ctx.fillRect(-18, -18, 36, 36);
                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ğŸ›¡ï¸', 0, 5);
            }

            drawCoin() {
                ctx.fillStyle = '#FFD700';
                ctx.fillRect(-20, -20, 40, 40);
                ctx.fillStyle = '#FFED4E';
                ctx.fillRect(-18, -18, 36, 36);
                ctx.fillStyle = '#FF8F00';
                ctx.font = 'bold 20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ğŸª™', 0, 5);
            }

            drawTree() {
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(-5, -10, 10, 20);
                ctx.fillStyle = '#228B22';
                ctx.beginPath();
                ctx.arc(0, -15, 15, 0, Math.PI * 2);
                ctx.fill();
            }

            drawFlower() {
                ctx.fillStyle = '#FF69B4';
                ctx.beginPath();
                ctx.arc(0, 0, 12, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#FFB6C1';
                ctx.beginPath();
                ctx.arc(-8, -8, 6, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(8, -8, 6, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(-8, 8, 6, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(8, 8, 6, 0, Math.PI * 2);
                ctx.fill();
            }

            drawCloud() {
                ctx.fillStyle = '#FFFFFF';
                ctx.beginPath();
                ctx.arc(-10, 0, 10, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(0, 0, 12, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(10, 0, 10, 0, Math.PI * 2);
                ctx.fill();
            }

            drawStar() {
                ctx.fillStyle = '#FFC107';
                ctx.fillRect(-20, -20, 40, 40);
                ctx.fillStyle = '#FFD54F';
                ctx.fillRect(-18, -18, 36, 36);
                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('âœ¨', 0, 5);
            }

            drawPlayer() {
                // æ–¹å—è§’è‰² - ä¸è›‹ä»”æœ‰5ç‚¹ä¸åŒ
                // 1. å½¢çŠ¶ï¼šæ–¹å—è€Œä¸æ˜¯åœ†å½¢
                // 2. é¢œè‰²ï¼šè“ç»¿é…è‰²è€Œä¸æ˜¯ç²‰é»„
                // 3. çœ¼ç›ï¼šæ–¹å½¢è€Œä¸æ˜¯åœ†å½¢
                // 4. å˜´å·´ï¼šç›´çº¿è€Œä¸æ˜¯å¼§å½¢
                // 5. èº«ä½“ï¼šæœ‰æ‰‹è‡‚å’Œè…¿éƒ¨ç»“æ„

                // å¤´éƒ¨ - è“è‰²æ–¹å—
                ctx.fillStyle = '#4A90E2';
                ctx.fillRect(-12, -15, 24, 24);
                ctx.fillStyle = '#2E5BBA';
                ctx.fillRect(-10, -13, 20, 20);

                // çœ¼ç› - æ–¹å½¢ç™½è‰²
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(-6, -8, 4, 4);
                ctx.fillRect(2, -8, 4, 4);

                // å˜´å·´ - ç›´çº¿
                ctx.fillStyle = '#FFD700';
                ctx.fillRect(-4, 2, 8, 2);

                // èº«ä½“ - ç»¿è‰²æ–¹å—
                ctx.fillStyle = '#7ED321';
                ctx.fillRect(-10, 5, 20, 20);
                ctx.fillStyle = '#5BA317';
                ctx.fillRect(-8, 7, 16, 16);

                // æ‰‹è‡‚ - æ©™è‰²æ–¹å—
                ctx.fillStyle = '#F5A623';
                ctx.fillRect(-15, 8, 8, 12);
                ctx.fillRect(7, 8, 8, 12);

                // è…¿éƒ¨ - çº¢è‰²æ–¹å—
                ctx.fillStyle = '#D0021B';
                ctx.fillRect(-8, 20, 6, 8);
                ctx.fillRect(2, 20, 6, 8);

                // è„š - é»‘è‰²æ–¹å—
                ctx.fillStyle = '#000000';
                ctx.fillRect(-10, 25, 8, 4);
                ctx.fillRect(2, 25, 8, 4);
            }

            update() {
                if (this.type === 'moving') {
                    this.x += this.moveSpeed * this.moveDirection;
                    if (this.x <= 0 || this.x >= canvas.width - this.width) {
                        this.moveDirection *= -1;
                    }
                }

                if (this.type === 'disappearing') {
                    this.disappearTimer++;
                    if (this.disappearTimer > 180) { // 3ç§’åå¼€å§‹æ¶ˆå¤±
                        this.isDisappearing = true;
                    }
                }
            }

            isPointInside(x, y) {
                return x >= this.x && x <= this.x + this.width &&
                    y >= this.y && y <= this.y + this.height;
            }
        }

        function initEditor() {
            canvas.addEventListener('click', handleCanvasClick);
            canvas.addEventListener('contextmenu', handleCanvasRightClick);

            document.querySelectorAll('.tool-item').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tool-item').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentTool = btn.dataset.type;
                    statusText.textContent = `å·²é€‰æ‹©: ${btn.textContent}`;
                });
            });

            document.getElementById('playBtn').addEventListener('click', togglePlay);
            document.getElementById('clearBtn').addEventListener('click', clearMap);
            document.getElementById('saveBtn').addEventListener('click', saveMap);
            document.getElementById('loadBtn').addEventListener('click', () => document.getElementById('fileInput').click());
            document.getElementById('fileInput').addEventListener('change', loadMap);

            // é”®ç›˜æ§åˆ¶
            document.addEventListener('keydown', (e) => {
                if (isPlaying) {
                    keys[e.key.toLowerCase()] = true;
                    if (e.key === 'Escape') {
                        togglePlay();
                    }
                }
            });

            document.addEventListener('keyup', (e) => {
                if (isPlaying) {
                    keys[e.key.toLowerCase()] = false;
                }
            });

            updateCounts();
            draw();
        }

        function handleCanvasClick(e) {
            if (isPlaying) return;

            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            if (currentTool) {
                const width = 40;
                const height = 40;
                gameObjects.push(new GameObject(x - width / 2, y - height / 2, currentTool, width, height));
                updateCounts();
                draw();
            }
        }

        function handleCanvasRightClick(e) {
            e.preventDefault();
            if (isPlaying) return;

            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            for (let i = gameObjects.length - 1; i >= 0; i--) {
                if (gameObjects[i].isPointInside(x, y)) {
                    gameObjects.splice(i, 1);
                    updateCounts();
                    draw();
                    break;
                }
            }
        }

        function updateCounts() {
            const platforms = gameObjects.filter(obj => ['platform', 'moving', 'disappearing', 'bouncy'].includes(obj.type)).length;
            const obstacles = gameObjects.filter(obj => ['wall', 'spike', 'rock', 'lava'].includes(obj.type)).length;
            const powerups = gameObjects.filter(obj => ['jump', 'speed', 'shield', 'coin'].includes(obj.type)).length;
            const decors = gameObjects.filter(obj => ['tree', 'flower', 'cloud', 'star'].includes(obj.type)).length;

            platformCount.textContent = platforms;
            obstacleCount.textContent = obstacles;
            powerupCount.textContent = powerups;
            decorCount.textContent = decors;
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#98FB98');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            gameObjects.forEach(obj => obj.draw());
        }

        function togglePlay() {
            if (isPlaying) {
                isPlaying = false;
                cancelAnimationFrame(gameLoop);
                document.getElementById('playBtn').textContent = 'å¼€å§‹æ¸¸æˆ';
                statusText.textContent = 'ç¼–è¾‘æ¨¡å¼';
                draw();
            } else {
                isPlaying = true;
                document.getElementById('playBtn').textContent = 'åœæ­¢æ¸¸æˆ';
                statusText.textContent = 'æ¸¸æˆæ¨¡å¼ - æ–¹å—è§’è‰²å¼€å§‹å†’é™©ï¼';
                startGame();
            }
        }

        function startGame() {
            // åˆ›å»ºç©å®¶è§’è‰²
            player = new GameObject(50, 50, 'player', 30, 30);
            player.velocityX = 0;
            player.velocityY = 0;
            player.onGround = false;

            gameLoop = requestAnimationFrame(updateGame);
        }

        function updateGame() {
            if (!isPlaying) return;

            // æ›´æ–°æ‰€æœ‰æ¸¸æˆå¯¹è±¡
            gameObjects.forEach(obj => obj.update());

            // æ›´æ–°ç©å®¶
            if (player) {
                // é”®ç›˜æ§åˆ¶
                if (keys['a'] || keys['arrowleft']) {
                    player.velocityX = -3;
                } else if (keys['d'] || keys['arrowright']) {
                    player.velocityX = 3;
                } else {
                    player.velocityX *= 0.8; // æ‘©æ“¦åŠ›
                }

                if ((keys['w'] || keys['arrowup'] || keys[' ']) && player.onGround) {
                    player.velocityY = -8;
                    player.onGround = false;
                }

                // é‡åŠ›
                player.velocityY += 0.5;

                // æ›´æ–°ä½ç½®
                player.x += player.velocityX;
                player.y += player.velocityY;

                // è¾¹ç•Œæ£€æŸ¥
                if (player.x < 0) player.x = 0;
                if (player.x > canvas.width - player.width) player.x = canvas.width - player.width;
                if (player.y > canvas.height - player.height) {
                    player.y = canvas.height - player.height;
                    player.velocityY = 0;
                    player.onGround = true;
                }

                // ç¢°æ’æ£€æµ‹
                gameObjects.forEach(obj => {
                    if (obj.type !== 'player' && checkCollision(player, obj)) {
                        if (obj.type.includes('platform') || obj.type === 'wall') {
                            if (player.velocityY > 0 && player.y < obj.y) {
                                player.y = obj.y - player.height;
                                player.velocityY = 0;
                                player.onGround = true;
                            }
                        }
                    }
                });
            }

            draw();
            if (player) {
                player.draw();
            }
            gameLoop = requestAnimationFrame(updateGame);
        }

        function checkCollision(obj1, obj2) {
            return obj1.x < obj2.x + obj2.width &&
                obj1.x + obj1.width > obj2.x &&
                obj1.y < obj2.y + obj2.height &&
                obj1.y + obj1.height > obj2.y;
        }

        function clearMap() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºåœ°å›¾å—ï¼Ÿ')) {
                gameObjects = [];
                updateCounts();
                draw();
                statusText.textContent = 'åœ°å›¾å·²æ¸…ç©º';
            }
        }

        function saveMap() {
            const mapData = {
                objects: gameObjects.map(obj => ({
                    x: obj.x,
                    y: obj.y,
                    type: obj.type,
                    width: obj.width,
                    height: obj.height,
                    rotation: obj.rotation
                }))
            };

            const blob = new Blob([JSON.stringify(mapData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'æ–¹å—ä¸–ç•Œåœ°å›¾.json';
            a.click();
            URL.revokeObjectURL(url);

            statusText.textContent = 'åœ°å›¾å·²ä¿å­˜';
        }

        function loadMap(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const mapData = JSON.parse(e.target.result);
                    gameObjects = mapData.objects.map(obj => {
                        const newObj = new GameObject(obj.x, obj.y, obj.type, obj.width, obj.height);
                        newObj.rotation = obj.rotation || 0;
                        return newObj;
                    });
                    updateCounts();
                    draw();
                    statusText.textContent = 'åœ°å›¾å·²åŠ è½½';
                } catch (error) {
                    alert('æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼');
                }
            };
            reader.readAsText(file);
        }

        initEditor();
    </script>
</body>

</html>