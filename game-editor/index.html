<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆç¼–è¾‘å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .main-container {
            display: flex;
            flex: 1;
            gap: 20px;
            padding: 20px;
        }

        .editor-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            width: 300px;
            height: fit-content;
        }

        .game-canvas-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .canvas-wrapper {
            position: relative;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        #gameCanvas {
            border: 3px solid #4CAF50;
            border-radius: 10px;
            background: #000814;
            display: block;
        }

        .tool-section {
            margin-bottom: 25px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
        }

        .tool-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .tool-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .tool-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .tool-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .tool-btn.active {
            background: #4CAF50;
            color: white;
        }

        .enemy-btn {
            background: #ff9800;
            color: white;
        }

        .player-btn {
            background: #2196F3;
            color: white;
        }

        .obstacle-btn {
            background: #9C27B0;
            color: white;
        }

        .powerup-btn {
            background: #E91E63;
            color: white;
        }

        .action-btn {
            background: #607D8B;
            color: white;
        }

        .control-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-btn {
            padding: 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .play-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .clear-btn {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }

        .save-btn {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
        }

        .load-btn {
            background: linear-gradient(135deg, #FF9800, #F57C00);
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .info-panel {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            font-size: 14px;
            color: #666;
        }

        .status-bar {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            text-align: center;
            font-size: 16px;
        }

        .file-input {
            display: none;
        }

        .instructions {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.6;
        }

        .instructions h4 {
            color: #333;
            margin-bottom: 10px;
        }

        .instructions ul {
            margin-left: 20px;
        }

        .instructions li {
            margin-bottom: 5px;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>ğŸ® æ¸¸æˆç¼–è¾‘å™¨</h1>
        <p>åˆ›é€ å±äºä½ çš„å°„å‡»æ¸¸æˆå…³å¡ï¼</p>
    </div>

    <div class="main-container">
        <div class="editor-panel">
            <div class="instructions">
                <h4>ğŸ“ ä½¿ç”¨è¯´æ˜</h4>
                <ul>
                    <li>é€‰æ‹©å·¥å…·åç‚¹å‡»ç”»å¸ƒæ”¾ç½®å…ƒç´ </li>
                    <li>å³é”®åˆ é™¤å…ƒç´ </li>
                    <li>å¯ä»¥ä¿å­˜å’ŒåŠ è½½å…³å¡</li>
                    <li>ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"æµ‹è¯•å…³å¡</li>
                </ul>
            </div>

            <div class="tool-section">
                <h3>ğŸ¯ æ•Œäººç±»å‹</h3>
                <div class="tool-buttons">
                    <button class="tool-btn enemy-btn" data-type="enemy1">å°èœœèœ‚ (10åˆ†)</button>
                    <button class="tool-btn enemy-btn" data-type="enemy2">é£ç¢Ÿ (20åˆ†)</button>
                    <button class="tool-btn enemy-btn" data-type="enemy3">å¤§Boss (30åˆ†)</button>
                    <button class="tool-btn enemy-btn" data-type="enemy4">å¿«é€Ÿæ•Œ (15åˆ†)</button>
                    <button class="tool-btn enemy-btn" data-type="enemy5">è‡ªçˆ†æ•Œ (25åˆ†)</button>
                    <button class="tool-btn enemy-btn" data-type="enemy6">åˆ†è£‚æ•Œ (20åˆ†)</button>
                </div>
            </div>

            <div class="tool-section">
                <h3>ğŸš€ ç©å®¶å…ƒç´ </h3>
                <div class="tool-buttons">
                    <button class="tool-btn player-btn" data-type="player">ç©å®¶é£èˆ¹</button>
                    <button class="tool-btn player-btn" data-type="spawn">å‡ºç”Ÿç‚¹</button>
                </div>
            </div>

            <div class="tool-section">
                <h3>ğŸ›¡ï¸ éšœç¢ç‰©</h3>
                <div class="tool-buttons">
                    <button class="tool-btn obstacle-btn" data-type="wall">å¢™å£</button>
                    <button class="tool-btn obstacle-btn" data-type="rock">å²©çŸ³</button>
                    <button class="tool-btn obstacle-btn" data-type="shield">æŠ¤ç›¾</button>
                </div>
            </div>

            <div class="tool-section">
                <h3>ğŸ’ é“å…·</h3>
                <div class="tool-buttons">
                    <button class="tool-btn powerup-btn" data-type="health">ç”Ÿå‘½å€¼</button>
                    <button class="tool-btn powerup-btn" data-type="speed">åŠ é€Ÿ</button>
                    <button class="tool-btn powerup-btn" data-type="power">ç«åŠ›å¢å¼º</button>
                    <button class="tool-btn powerup-btn" data-type="shield">æŠ¤ç›¾</button>
                    <button class="tool-btn powerup-btn" data-type="multishot">å¤šé‡å°„å‡»</button>
                    <button class="tool-btn powerup-btn" data-type="bomb">ç‚¸å¼¹</button>
                </div>
            </div>

            <div class="tool-section">
                <h3>âš™ï¸ æ“ä½œ</h3>
                <div class="control-section">
                    <button class="control-btn play-btn" id="playBtn">å¼€å§‹æ¸¸æˆ</button>
                    <button class="control-btn clear-btn" id="clearBtn">æ¸…ç©ºç”»å¸ƒ</button>
                    <button class="control-btn save-btn" id="saveBtn">ä¿å­˜å…³å¡</button>
                    <button class="control-btn load-btn" id="loadBtn">åŠ è½½å…³å¡</button>
                    <input type="file" class="file-input" id="fileInput" accept=".json">
                </div>
            </div>

            <div class="info-panel">
                <h4>ğŸ“Š å…³å¡ä¿¡æ¯</h4>
                <p>æ•Œäººæ•°é‡: <span id="enemyCount">0</span></p>
                <p>é“å…·æ•°é‡: <span id="powerupCount">0</span></p>
                <p>éšœç¢ç‰©æ•°é‡: <span id="obstacleCount">0</span></p>
            </div>
        </div>

        <div class="game-canvas-container">
            <div class="canvas-wrapper">
                <canvas id="gameCanvas" width="800" height="600"></canvas>
            </div>
            <div class="status-bar">
                <span id="statusText">é€‰æ‹©å·¥å…·å¼€å§‹ç¼–è¾‘</span>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const statusText = document.getElementById('statusText');
        const enemyCount = document.getElementById('enemyCount');
        const powerupCount = document.getElementById('powerupCount');
        const obstacleCount = document.getElementById('obstacleCount');

        let currentTool = null;
        let gameObjects = [];
        let isPlaying = false;
        let gameLoop;

        class GameObject {
            constructor(x, y, type, width = 40, height = 30) {
                this.x = x;
                this.y = y;
                this.type = type;
                this.width = width;
                this.height = height;
                this.id = Math.random().toString(36).substr(2, 9);
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);

                switch (this.type) {
                    case 'enemy1':
                        this.drawEnemy1();
                        break;
                    case 'enemy2':
                        this.drawEnemy2();
                        break;
                    case 'enemy3':
                        this.drawEnemy3();
                        break;
                    case 'enemy4':
                        this.drawEnemy4();
                        break;
                    case 'enemy5':
                        this.drawEnemy5();
                        break;
                    case 'enemy6':
                        this.drawEnemy6();
                        break;
                    case 'player':
                        this.drawPlayer();
                        break;
                    case 'spawn':
                        this.drawSpawn();
                        break;
                    case 'wall':
                        this.drawWall();
                        break;
                    case 'rock':
                        this.drawRock();
                        break;
                    case 'shield':
                        this.drawShield();
                        break;
                    case 'health':
                        this.drawHealth();
                        break;
                    case 'speed':
                        this.drawSpeed();
                        break;
                    case 'power':
                        this.drawPower();
                        break;
                    case 'multishot':
                        this.drawMultishot();
                        break;
                    case 'bomb':
                        this.drawBomb();
                        break;
                }
                ctx.restore();
            }

            drawEnemy1() {
                ctx.fillStyle = '#ff00ff';
                ctx.fillRect(5, 0, 30, 25);
                ctx.fillRect(0, 10, 5, 15);
                ctx.fillRect(35, 10, 5, 15);
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(10, 8, 6, 6);
                ctx.fillRect(24, 8, 6, 6);
            }

            drawEnemy2() {
                ctx.fillStyle = '#ffff00';
                ctx.beginPath();
                ctx.arc(20, 15, 15, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(5, 12, 30, 6);
            }

            drawEnemy3() {
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(0, 0, 40, 30);
                ctx.fillStyle = '#ffff00';
                ctx.fillRect(5, 5, 30, 20);
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(10, 10, 20, 10);
            }

            drawEnemy4() {
                ctx.fillStyle = '#00ff00';
                ctx.fillRect(10, 0, 20, 25);
                ctx.fillRect(5, 10, 30, 5);
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(15, 5, 4, 4);
                ctx.fillRect(21, 5, 4, 4);
            }

            drawEnemy5() {
                ctx.fillStyle = '#ff6600';
                ctx.fillRect(5, 5, 30, 20);
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(10, 10, 20, 10);
                ctx.fillStyle = '#ffff00';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ğŸ’¥', 20, 18);
            }

            drawEnemy6() {
                ctx.fillStyle = '#800080';
                ctx.fillRect(5, 0, 30, 25);
                ctx.fillStyle = '#ff00ff';
                ctx.fillRect(10, 5, 20, 15);
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('åˆ†', 20, 16);
            }

            drawPlayer() {
                ctx.fillStyle = '#00ff00';
                ctx.beginPath();
                ctx.moveTo(20, 0);
                ctx.lineTo(0, 30);
                ctx.lineTo(20, 20);
                ctx.lineTo(40, 30);
                ctx.closePath();
                ctx.fill();
            }

            drawSpawn() {
                ctx.strokeStyle = '#00ffff';
                ctx.lineWidth = 3;
                ctx.setLineDash([5, 5]);
                ctx.strokeRect(0, 0, 40, 30);
                ctx.setLineDash([]);
                ctx.fillStyle = '#00ffff';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('å‡ºç”Ÿ', 20, 18);
            }

            drawWall() {
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(0, 0, 40, 30);
                ctx.fillStyle = '#A0522D';
                ctx.fillRect(5, 5, 30, 20);
            }

            drawRock() {
                ctx.fillStyle = '#696969';
                ctx.beginPath();
                ctx.arc(20, 15, 15, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#808080';
                ctx.beginPath();
                ctx.arc(15, 10, 5, 0, Math.PI * 2);
                ctx.fill();
            }

            drawShield() {
                ctx.strokeStyle = '#00ffff';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(20, 15, 15, 0, Math.PI * 2);
                ctx.stroke();
                ctx.fillStyle = 'rgba(0, 255, 255, 0.3)';
                ctx.fill();
            }

            drawHealth() {
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(15, 5, 10, 20);
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(17, 7, 6, 16);
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(18, 8, 4, 14);
            }

            drawSpeed() {
                ctx.fillStyle = '#ffff00';
                ctx.fillRect(10, 10, 20, 10);
                ctx.fillStyle = '#ff0000';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('S', 20, 18);
            }

            drawPower() {
                ctx.fillStyle = '#ff00ff';
                ctx.fillRect(10, 5, 20, 20);
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('P', 20, 18);
            }

            drawMultishot() {
                ctx.fillStyle = '#00ffff';
                ctx.fillRect(10, 5, 20, 20);
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('M', 20, 18);
            }

            drawBomb() {
                ctx.fillStyle = '#ff0000';
                ctx.beginPath();
                ctx.arc(20, 15, 12, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#ffff00';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ğŸ’£', 20, 18);
            }

            isPointInside(x, y) {
                return x >= this.x && x <= this.x + this.width &&
                    y >= this.y && y <= this.y + this.height;
            }
        }

        function initEditor() {
            canvas.addEventListener('click', handleCanvasClick);
            canvas.addEventListener('contextmenu', handleCanvasRightClick);

            document.querySelectorAll('.tool-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentTool = btn.dataset.type;
                    statusText.textContent = `å·²é€‰æ‹©: ${btn.textContent}`;
                });
            });

            document.getElementById('playBtn').addEventListener('click', togglePlay);
            document.getElementById('clearBtn').addEventListener('click', clearCanvas);
            document.getElementById('saveBtn').addEventListener('click', saveLevel);
            document.getElementById('loadBtn').addEventListener('click', () => document.getElementById('fileInput').click());
            document.getElementById('fileInput').addEventListener('change', loadLevel);

            updateCounts();
            draw();
        }

        function handleCanvasClick(e) {
            if (isPlaying) return;

            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            if (currentTool) {
                const width = currentTool.includes('enemy') ? 40 : 40;
                const height = currentTool.includes('enemy') ? 30 : 30;
                gameObjects.push(new GameObject(x - width / 2, y - height / 2, currentTool, width, height));
                updateCounts();
                draw();
            }
        }

        function handleCanvasRightClick(e) {
            e.preventDefault();
            if (isPlaying) return;

            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            for (let i = gameObjects.length - 1; i >= 0; i--) {
                if (gameObjects[i].isPointInside(x, y)) {
                    gameObjects.splice(i, 1);
                    updateCounts();
                    draw();
                    break;
                }
            }
        }

        function updateCounts() {
            const enemies = gameObjects.filter(obj => obj.type.startsWith('enemy')).length;
            const powerups = gameObjects.filter(obj => ['health', 'speed', 'power', 'shield'].includes(obj.type)).length;
            const obstacles = gameObjects.filter(obj => ['wall', 'rock'].includes(obj.type)).length;

            enemyCount.textContent = enemies;
            powerupCount.textContent = powerups;
            obstacleCount.textContent = obstacles;
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // ç»˜åˆ¶ç½‘æ ¼
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;
            for (let x = 0; x < canvas.width; x += 40) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            for (let y = 0; y < canvas.height; y += 30) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }

            // ç»˜åˆ¶æ¸¸æˆå¯¹è±¡
            gameObjects.forEach(obj => obj.draw());
        }

        function togglePlay() {
            if (isPlaying) {
                isPlaying = false;
                cancelAnimationFrame(gameLoop);
                document.getElementById('playBtn').textContent = 'å¼€å§‹æ¸¸æˆ';
                statusText.textContent = 'ç¼–è¾‘æ¨¡å¼';
                draw();
            } else {
                isPlaying = true;
                document.getElementById('playBtn').textContent = 'åœæ­¢æ¸¸æˆ';
                statusText.textContent = 'æ¸¸æˆæ¨¡å¼';
                startGame();
            }
        }

        function startGame() {
            // è¿™é‡Œå¯ä»¥æ·»åŠ æ¸¸æˆé€»è¾‘
            statusText.textContent = 'æ¸¸æˆè¿è¡Œä¸­...';
        }

        function clearCanvas() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºç”»å¸ƒå—ï¼Ÿ')) {
                gameObjects = [];
                updateCounts();
                draw();
                statusText.textContent = 'ç”»å¸ƒå·²æ¸…ç©º';
            }
        }

        function saveLevel() {
            const levelData = {
                objects: gameObjects.map(obj => ({
                    x: obj.x,
                    y: obj.y,
                    type: obj.type,
                    width: obj.width,
                    height: obj.height
                }))
            };

            const blob = new Blob([JSON.stringify(levelData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'level.json';
            a.click();
            URL.revokeObjectURL(url);

            statusText.textContent = 'å…³å¡å·²ä¿å­˜';
        }

        function loadLevel(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const levelData = JSON.parse(e.target.result);
                    gameObjects = levelData.objects.map(obj => new GameObject(obj.x, obj.y, obj.type, obj.width, obj.height));
                    updateCounts();
                    draw();
                    statusText.textContent = 'å…³å¡å·²åŠ è½½';
                } catch (error) {
                    alert('æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼');
                }
            };
            reader.readAsText(file);
        }

        initEditor();
    </script>
</body>

</html>